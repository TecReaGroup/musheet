# MuSheet Team åŒæ­¥é€»è¾‘

æœ¬æ–‡æ¡£æè¿° MuSheet Flutter App çš„ Teamï¼ˆå›¢é˜Ÿï¼‰åŠŸèƒ½åŒæ­¥æ¶æ„ï¼Œé‡‡ç”¨ä¸ä¸ªäººåº“ç›¸åŒçš„**å…ƒæ•°æ®é€šé“**ä¸**æ–‡ä»¶é€šé“**åˆ†ç¦»è®¾è®¡ï¼Œä½† Team æ•°æ®å®Œå…¨ç‹¬ç«‹äºä¸ªäººåº“ã€‚

---

## ç›®å½•

1. [æ€»ä½“è®¾è®¡åŸåˆ™](#1-æ€»ä½“è®¾è®¡åŸåˆ™)
2. [æ•°æ®æ¨¡å‹](#2-æ•°æ®æ¨¡å‹)
3. [å¯¼å…¥ä¸åˆ›å»ºé€»è¾‘](#3-å¯¼å…¥ä¸åˆ›å»ºé€»è¾‘)
4. [åŒæ­¥æµç¨‹](#4-åŒæ­¥æµç¨‹)
5. [PDF æ–‡ä»¶å¤„ç†](#5-pdf-æ–‡ä»¶å¤„ç†)
6. [å†²çªè§£å†³](#6-å†²çªè§£å†³)
7. [ç‰¹æ®Šåœºæ™¯](#7-ç‰¹æ®Šåœºæ™¯)

---

## 1. æ€»ä½“è®¾è®¡åŸåˆ™

### 1.1 æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Team åŒæ­¥æ¶æ„                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚     ä¸ªäººåº“        â”‚              â”‚      Team åº“      â”‚            â”‚
â”‚   â”‚   (ç‹¬ç«‹æ•°æ®)      â”‚    å¤åˆ¶ â†’    â”‚    (ç‹¬ç«‹æ•°æ®)     â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚ Score            â”‚              â”‚ TeamScore        â”‚            â”‚
â”‚   â”‚ InstrumentScore  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚ TeamInstrumentScoreâ”‚           â”‚
â”‚   â”‚ Setlist          â”‚              â”‚ TeamSetlist      â”‚            â”‚
â”‚   â”‚ SetlistScore     â”‚              â”‚ TeamSetlistScore â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                            â”‚                         â”‚
â”‚                                            â–¼                         â”‚
â”‚                                     å…±äº« PDF å­˜å‚¨                    â”‚
â”‚                                     (åŸºäº pdfHash)                   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **æ•°æ®ç‹¬ç«‹** | Team æ•°æ®å®Œå…¨ç‹¬ç«‹äºä¸ªäººåº“ï¼Œé‡‡ç”¨å¤åˆ¶æ¨¡å¼è€Œéå¼•ç”¨æ¨¡å¼ |
| **PDF å¤ç”¨** | Team å’Œä¸ªäººåº“å…±äº« PDF å­˜å‚¨ï¼ŒåŸºäº pdfHash å»é‡ |
| **æŒ‰éœ€ä¸‹è½½** | PDF ä¸è‡ªåŠ¨ä¸‹è½½ï¼Œä»…åœ¨ç”¨æˆ·æ‰“å¼€ Score æ—¶æŒ‰éœ€ä¸‹è½½ |
| **æˆå‘˜å¹³ç­‰** | æ‰€æœ‰æˆå‘˜éƒ½æœ‰ç›¸åŒçš„ç¼–è¾‘æƒé™ï¼ˆåªæœ‰ member ä¸€ç§è§’è‰²ï¼‰ |
| **å”¯ä¸€æ€§çº¦æŸ** | åŒä¸€ Team ä¸­ä¸å…è®¸å­˜åœ¨åŒå (title + composer) çš„ Score æˆ–åŒå Setlist |
| **æœ¬åœ°ä¼˜å…ˆ** | UI æ“ä½œç«‹å³å†™å…¥æœ¬åœ°ï¼Œåå°å¼‚æ­¥åŒæ­¥ |
| **å…¥å£å”¯ä¸€** | Team å†…å®¹åªèƒ½é€šè¿‡ Team ç•Œé¢çš„ Add æŒ‰é’®æ·»åŠ ï¼Œä¸ªäººåº“æ— "å¤åˆ¶åˆ°å›¢é˜Ÿ"é€‰é¡¹ |
| **æ‹’ç»é‡å¤** | ä» Library å¯¼å…¥æ—¶ï¼Œè‹¥ Team ä¸­å·²æœ‰åŒå Score/Setlist åˆ™æ‹’ç»å¯¼å…¥ |

### 1.3 ä¸ä¸ªäººåº“çš„åŒºåˆ«

| å¯¹æ¯”é¡¹ | ä¸ªäººåº“ | Team |
|--------|--------|------|
| æ•°æ®æ‰€æœ‰æƒ | å•ç”¨æˆ· | å¤šç”¨æˆ·å…±äº« |
| ç‰ˆæœ¬å· | libraryVersion | teamLibraryVersion (æ¯ä¸ª Team ç‹¬ç«‹) |
| å†²çªæ¥æº | å¤šè®¾å¤‡ | å¤šç”¨æˆ· + å¤šè®¾å¤‡ |
| PDF ä¸‹è½½ | å¯é€‰è‡ªåŠ¨ä¸‹è½½ | ä»…æŒ‰éœ€ä¸‹è½½ |
| å¯¼å…¥æ–¹å¼ | ç›´æ¥åˆ›å»º | ç›´æ¥åˆ›å»º æˆ– ä» Library å¯¼å…¥ï¼ˆé€šè¿‡ Add æŒ‰é’®ï¼‰ |
| æ·»åŠ åˆ†è°± | ä»»ä½•æ—¶å€™å¯æ·»åŠ  | åªèƒ½åœ¨ TeamScore è¯¦æƒ…é¡µæ·»åŠ åŒåæ›²ç›®çš„åˆ†è°± |

---

## 2. æ•°æ®æ¨¡å‹

### 2.1 å®ä½“å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Team å®ä½“å…³ç³»                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Team (å›¢é˜Ÿ)                                                        â”‚
â”‚  â”œâ”€â”€ id (PK)                                                        â”‚
â”‚  â”œâ”€â”€ name                                                           â”‚
â”‚  â”œâ”€â”€ createdById (åˆ›å»ºè€… userId)                                    â”‚
â”‚  â””â”€â”€ createdAt, updatedAt, deletedAt                                â”‚
â”‚  æ³¨: æˆå‘˜ç®¡ç†é€šè¿‡åç«¯ WebUI è¿›è¡Œï¼Œæ— é‚€è¯·ç æœºåˆ¶                        â”‚
â”‚       â”‚                                                             â”‚
â”‚       â”‚ 1:N                                                         â”‚
â”‚       â–¼                                                             â”‚
â”‚  TeamMember (å›¢é˜Ÿæˆå‘˜)                                               â”‚
â”‚  â”œâ”€â”€ id (PK)                                                        â”‚
â”‚  â”œâ”€â”€ teamId (FK â†’ Team)                                             â”‚
â”‚  â”œâ”€â”€ userId (FK â†’ User)                                             â”‚
â”‚  â”œâ”€â”€ role = 'member' (å”¯ä¸€è§’è‰²ï¼Œæ‰€æœ‰æˆå‘˜å¹³ç­‰)                         â”‚
â”‚  â””â”€â”€ joinedAt                                                       â”‚
â”‚                                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                      â”‚
â”‚  TeamScore (å›¢é˜Ÿä¹è°±)                                                â”‚
â”‚  â”œâ”€â”€ id (PK)                                                        â”‚
â”‚  â”œâ”€â”€ teamId (FK â†’ Team)                                             â”‚
â”‚  â”œâ”€â”€ title                                                          â”‚
â”‚  â”œâ”€â”€ composer                                                       â”‚
â”‚  â”œâ”€â”€ bpm                                                            â”‚
â”‚  â”œâ”€â”€ createdById (åˆ›å»º/å¯¼å…¥è€… userId)                                â”‚
â”‚  â”œâ”€â”€ sourceScoreId (nullable, ä»ä¸ªäººåº“å¤åˆ¶æ—¶è®°å½•æ¥æº serverId)        â”‚
â”‚  â”œâ”€â”€ syncStatus ('pending' | 'synced')                              â”‚
â”‚  â”œâ”€â”€ version (int)                                                  â”‚
â”‚  â””â”€â”€ createdAt, updatedAt, deletedAt                                â”‚
â”‚       â”‚                                                             â”‚
â”‚       â”‚ 1:N                                                         â”‚
â”‚       â–¼                                                             â”‚
â”‚  TeamInstrumentScore (å›¢é˜Ÿåˆ†è°±)                                      â”‚
â”‚  â”œâ”€â”€ id (PK)                                                        â”‚
â”‚  â”œâ”€â”€ teamScoreId (FK â†’ TeamScore)                                   â”‚
â”‚  â”œâ”€â”€ instrumentType                                                 â”‚
â”‚  â”œâ”€â”€ customInstrument                                               â”‚
â”‚  â”œâ”€â”€ pdfHash (MD5, å¤ç”¨å…¨å±€ PDF å­˜å‚¨)                                â”‚
â”‚  â”œâ”€â”€ pdfPath (æœ¬åœ°è·¯å¾„)                                              â”‚
â”‚  â”œâ”€â”€ pdfSyncStatus ('pending' | 'synced' | 'needsDownload')         â”‚
â”‚  â”œâ”€â”€ annotationsJson (Team ç‹¬ç«‹æ ‡æ³¨ï¼Œä»ä¸ªäººåº“å¤åˆ¶æ—¶ä¼šå¤åˆ¶)            â”‚
â”‚  â”œâ”€â”€ sourceInstrumentScoreId (nullable)                             â”‚
â”‚  â”œâ”€â”€ syncStatus, version                                            â”‚
â”‚  â””â”€â”€ createdAt, updatedAt, deletedAt                                â”‚
â”‚                                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                      â”‚
â”‚  TeamSetlist (å›¢é˜Ÿæ›²å•)                                              â”‚
â”‚  â”œâ”€â”€ id (PK)                                                        â”‚
â”‚  â”œâ”€â”€ teamId (FK â†’ Team)                                             â”‚
â”‚  â”œâ”€â”€ name                                                           â”‚
â”‚  â”œâ”€â”€ description                                                    â”‚
â”‚  â”œâ”€â”€ createdById                                                    â”‚
â”‚  â”œâ”€â”€ sourceSetlistId (nullable)                                     â”‚
â”‚  â”œâ”€â”€ syncStatus, version                                            â”‚
â”‚  â””â”€â”€ createdAt, updatedAt, deletedAt                                â”‚
â”‚       â”‚                                                             â”‚
â”‚       â”‚ 1:N                                                         â”‚
â”‚       â–¼                                                             â”‚
â”‚  TeamSetlistScore (å›¢é˜Ÿæ›²å•å…³è”)                                     â”‚
â”‚  â”œâ”€â”€ id (PK)                                                        â”‚
â”‚  â”œâ”€â”€ teamSetlistId (FK â†’ TeamSetlist)                               â”‚
â”‚  â”œâ”€â”€ teamScoreId (FK â†’ TeamScore)  â† æ³¨æ„ï¼šå¼•ç”¨çš„æ˜¯ TeamScore        â”‚
â”‚  â”œâ”€â”€ orderIndex                                                     â”‚
â”‚  â”œâ”€â”€ syncStatus, version                                            â”‚
â”‚  â””â”€â”€ createdAt, updatedAt, deletedAt                                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å”¯ä¸€æ€§çº¦æŸ

| å®ä½“ | å”¯ä¸€é”® | è¯´æ˜ |
|------|--------|------|
| TeamScore | (teamId, title, composer) | åŒä¸€ Team ä¸­ä¸å…è®¸åŒåæ›²ç›® |
| TeamInstrumentScore | (teamScoreId, instrumentType, customInstrument) | åŒä¸€ Score ä¸­ä¸å…è®¸é‡å¤ä¹å™¨ |
| TeamSetlist | (teamId, name) | åŒä¸€ Team ä¸­ä¸å…è®¸åŒåæ›²å• |
| TeamSetlistScore | (teamSetlistId, teamScoreId) | åŒä¸€æ›²å•ä¸­ä¸å…è®¸é‡å¤æ›²ç›® |

### 2.3 åŒæ­¥çŠ¶æ€è¡¨

æ¯ä¸ª Team ç»´æŠ¤ç‹¬ç«‹çš„åŒæ­¥ç‰ˆæœ¬ï¼š

```
TeamSyncState (æœ¬åœ°è¡¨)
â”œâ”€â”€ teamId (PK)
â”œâ”€â”€ teamLibraryVersion (è¯¥å›¢é˜Ÿçš„ç‰ˆæœ¬å·)
â””â”€â”€ lastSyncAt
```

### 2.4 åŒæ­¥å­—æ®µè§„èŒƒ

æ¯ä¸ª Team å®ä½“éƒ½åŒ…å«ä»¥ä¸‹åŒæ­¥å­—æ®µï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | INT | æœåŠ¡å™¨ç«¯ä¸»é”® |
| `syncStatus` | TEXT | `pending` / `synced` |
| `version` | INT (64-bit) | è¯¥è®°å½•çš„ç‰ˆæœ¬å· |
| `updatedAt` | DATETIME | æœ€åæ›´æ–°æ—¶é—´ |
| `deletedAt` | DATETIME? | è½¯åˆ é™¤æ—¶é—´æˆ³ |

---

## 3. å¯¼å…¥ä¸åˆ›å»ºé€»è¾‘

### 3.0 å…¥å£é™åˆ¶

**é‡è¦ï¼šTeam å†…å®¹åªèƒ½é€šè¿‡å³ä¸‹è§’çš„ Add æŒ‰é’®æ·»åŠ **

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Team å†…å®¹æ·»åŠ å…¥å£                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚                    Team ç•Œé¢                         â”‚            â”‚
â”‚  â”‚                                                      â”‚            â”‚
â”‚  â”‚                                                      â”‚            â”‚
â”‚  â”‚                                                      â”‚            â”‚
â”‚  â”‚                                                      â”‚            â”‚
â”‚  â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚
â”‚  â”‚                                    â”‚      +       â”‚  â”‚ â† å³ä¸‹è§’   â”‚
â”‚  â”‚                                    â”‚  Add æŒ‰é’®    â”‚  â”‚   FAB      â”‚
â”‚  â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â”‚ ç‚¹å‡»                                  â”‚
â”‚                              â–¼                                       â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚   é€‰æ‹©æ·»åŠ æ–¹å¼       â”‚                          â”‚
â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚                    â”‚ ğŸ“„ ç›´æ¥åˆ›å»º          â”‚ â†’ å¯¼å…¥æ–° PDF åˆ›å»º        â”‚
â”‚                    â”‚ ğŸ“¥ ä» Library å¯¼å…¥   â”‚ â†’ ä»ä¸ªäººåº“é€‰æ‹©å¤åˆ¶       â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                      â”‚
â”‚  æ³¨æ„: ä¸ªäººåº“ç•Œé¢æ²¡æœ‰"å¤åˆ¶åˆ°å›¢é˜Ÿ"é€‰é¡¹ï¼Œå¿…é¡»åœ¨ Team ç•Œé¢æ“ä½œ           â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.1 åˆ›å»º TeamScore çš„ä¸¤ç§æ–¹å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»º TeamScore çš„ä¸¤ç§æ–¹å¼                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  æ–¹å¼ 1: ç›´æ¥åˆ›å»º (å¯¼å…¥æ–° PDF)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç”¨æˆ·ç‚¹å‡» Add æŒ‰é’® â†’ é€‰æ‹© "ç›´æ¥åˆ›å»º"                             â”‚ â”‚
â”‚  â”‚ â†’ é€‰æ‹© PDF æ–‡ä»¶å¹¶è¾“å…¥ title/composer                           â”‚ â”‚
â”‚  â”‚ â†’ åˆ›å»º TeamScore (sourceScoreId = null)                        â”‚ â”‚
â”‚  â”‚ â†’ åˆ›å»º TeamInstrumentScore                                     â”‚ â”‚
â”‚  â”‚ â†’ ä¸Šä¼  PDF (ä½¿ç”¨å…¨å±€ pdfHash æœºåˆ¶)                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  æ–¹å¼ 2: ä» Library å¯¼å…¥                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç”¨æˆ·ç‚¹å‡» Add æŒ‰é’® â†’ é€‰æ‹© "ä» Library å¯¼å…¥"                      â”‚ â”‚
â”‚  â”‚ â†’ æ˜¾ç¤ºä¸ªäººåº“åˆ—è¡¨ï¼Œé€‰æ‹© Score æˆ– Setlist                         â”‚ â”‚
â”‚  â”‚ â†’ å¤åˆ¶ Score å…ƒæ•°æ® â†’ TeamScore (sourceScoreId = åŸ serverId)  â”‚ â”‚
â”‚  â”‚ â†’ è”çº§å¤åˆ¶æ‰€æœ‰ InstrumentScore â†’ TeamInstrumentScore            â”‚ â”‚
â”‚  â”‚ â†’ è”çº§å¤åˆ¶ annotationsJsonï¼ˆTeam ç‹¬ç«‹å‰¯æœ¬ï¼‰                      â”‚ â”‚
â”‚  â”‚ â†’ pdfHash ç›´æ¥å¤åˆ¶ï¼ˆä¸æœ¬åœ° Library å…±ç”¨ PDF æ–‡ä»¶ï¼‰               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ä» Library å¯¼å…¥ Score çš„æµç¨‹

**é‡è¦ï¼šä¸æ”¯æŒå¯¼å…¥é‡å¤çš„ Scoreï¼åªæœ‰åœ¨ TeamScore è¯¦ç»†é¡µæ‰èƒ½æ·»åŠ åˆ†è°±**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä» Library å¯¼å…¥ Score åˆ° Team                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚ ç”¨æˆ·åœ¨ Add èœå•é€‰æ‹©  â”‚                          â”‚
â”‚                    â”‚ "ä» Library å¯¼å…¥"    â”‚                          â”‚
â”‚                    â”‚ â†’ é€‰æ‹© Score         â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                               â”‚                                      â”‚
â”‚                               â–¼                                      â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚            â”‚ æ£€æŸ¥: Team ä¸­æ˜¯å¦å·²æœ‰åŒå Scoreï¼Ÿ â”‚                     â”‚
â”‚            â”‚ WHERE teamId = ? AND title = ?   â”‚                     â”‚
â”‚            â”‚   AND composer = ?               â”‚                     â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                     YES              NO                              â”‚
â”‚                      â”‚               â”‚                               â”‚
â”‚                      â–¼               â–¼                               â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚         â”‚ âŒ æ‹’ç»å¯¼å…¥         â”‚  â”‚ âœ… æ‰§è¡Œå¯¼å…¥                 â”‚      â”‚
â”‚         â”‚                    â”‚  â”‚                            â”‚      â”‚
â”‚         â”‚ æç¤º: "å›¢é˜Ÿä¸­å·²æœ‰   â”‚  â”‚ 1. åˆ›å»º TeamScore          â”‚      â”‚
â”‚         â”‚ åŒåæ›²ç›®ï¼Œæ— æ³•å¯¼å…¥" â”‚  â”‚    (sourceScoreId = åŸID)  â”‚      â”‚
â”‚         â”‚                    â”‚  â”‚                            â”‚      â”‚
â”‚         â”‚ å¦‚éœ€æ·»åŠ åˆ†è°±ï¼Œè¯·    â”‚  â”‚ 2. è”çº§å¤åˆ¶æ‰€æœ‰åˆ†è°±        â”‚      â”‚
â”‚         â”‚ åœ¨ Team æ›²ç›®è¯¦æƒ…é¡µ  â”‚  â”‚    â†’ TeamInstrumentScore   â”‚      â”‚
â”‚         â”‚ ä¸­æ“ä½œ              â”‚  â”‚    â†’ å¤åˆ¶ annotationsJson  â”‚      â”‚
â”‚         â”‚                    â”‚  â”‚    â†’ å…±ç”¨ pdfHash å’Œ PDF   â”‚      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 åœ¨ TeamScore è¯¦æƒ…é¡µæ·»åŠ åˆ†è°±

**è¿™æ˜¯å”¯ä¸€å¯ä»¥å‘å·²æœ‰ TeamScore æ·»åŠ åˆ†è°±çš„å…¥å£**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœ¨ TeamScore è¯¦æƒ…é¡µæ·»åŠ åˆ†è°±                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  åœºæ™¯: Team ä¸­å·²æœ‰ "Canon - Pachelbel"ï¼Œ                             â”‚
â”‚        ä¸ªäººåº“ä¸­ä¹Ÿæœ‰åŒåæ›²ç›®ï¼Œä½†æœ‰ä¸åŒçš„åˆ†è°±                           â”‚
â”‚                                                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚ TeamScore è¯¦æƒ…é¡µ     â”‚                          â”‚
â”‚                    â”‚ "Canon - Pachelbel" â”‚                          â”‚
â”‚                    â”‚                     â”‚                          â”‚
â”‚                    â”‚ ç°æœ‰åˆ†è°±:            â”‚                          â”‚
â”‚                    â”‚ â€¢ Violin            â”‚                          â”‚
â”‚                    â”‚ â€¢ Cello             â”‚                          â”‚
â”‚                    â”‚                     â”‚                          â”‚
â”‚                    â”‚ [+ æ·»åŠ åˆ†è°±] â—„â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€ ç‚¹å‡»                  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚               â”‚    é€‰æ‹©æ·»åŠ åˆ†è°±æ–¹å¼           â”‚                      â”‚
â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚               â”‚ ğŸ“„ ç›´æ¥åˆ›å»º (å¯¼å…¥æ–° PDF)      â”‚                      â”‚
â”‚               â”‚ ğŸ“¥ ä» Library åŒåæ›²ç›®å¯¼å…¥    â”‚ â† åªæ˜¾ç¤ºåŒåæ›²ç›®      â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â”‚ é€‰æ‹© "ä» Library åŒåæ›²ç›®å¯¼å…¥"        â”‚
â”‚                              â–¼                                       â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚               â”‚  æ˜¾ç¤ºä¸ªäººåº“åŒåæ›²ç›®çš„åˆ†è°±     â”‚                      â”‚
â”‚               â”‚  (è¿‡æ»¤æ‰ Team ä¸­å·²æœ‰çš„)       â”‚                      â”‚
â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚               â”‚ â˜‘ Piano (æ–°)                 â”‚ â† å¯é€‰                â”‚
â”‚               â”‚ â˜ Violin (å·²å­˜åœ¨)            â”‚ â† ç°è‰²ç¦ç”¨            â”‚
â”‚               â”‚ â˜ Cello (å·²å­˜åœ¨)             â”‚ â† ç°è‰²ç¦ç”¨            â”‚
â”‚               â”‚ â˜‘ Flute (æ–°)                 â”‚ â† å¯é€‰                â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚               â”‚  åªå¯¼å…¥é€‰ä¸­çš„æ–°åˆ†è°±           â”‚                      â”‚
â”‚               â”‚  â†’ TeamInstrumentScore       â”‚                      â”‚
â”‚               â”‚  â†’ å¤åˆ¶ annotations          â”‚                      â”‚
â”‚               â”‚  â†’ å…±ç”¨ PDF                  â”‚                      â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 ä» Library å¯¼å…¥ Setlist çš„æµç¨‹

**é‡è¦ï¼šä¸æ”¯æŒå¯¼å…¥é‡å¤çš„ Setlistï¼è”çº§å¯¼å…¥æ‰€æœ‰ç›¸å…³ Score**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä» Library å¯¼å…¥ Setlist åˆ° Team                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  æ­¥éª¤ 1: æ£€æŸ¥ Setlist æœ¬èº«                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Team ä¸­æ˜¯å¦å·²æœ‰åŒå Setlistï¼Ÿ                                   â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€ YES â†’ âŒ æ‹’ç»å¯¼å…¥ï¼Œæç¤º "æ›²å•å·²å­˜åœ¨äºå›¢é˜Ÿä¸­"               â”‚ â”‚
â”‚  â”‚ â””â”€â”€ NO  â†’ âœ… ç»§ç»­                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  æ­¥éª¤ 2: è”çº§å¤„ç† Setlist ä¸­çš„æ¯ä¸ª Score                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ FOR EACH Score in Setlist:                                      â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚   â”‚ Team ä¸­æ˜¯å¦æœ‰åŒå (title + composer) çš„ TeamScoreï¼Ÿ     â”‚  â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                           â”‚ â”‚
â”‚  â”‚                   YES              NO                           â”‚ â”‚
â”‚  â”‚                    â”‚               â”‚                            â”‚ â”‚
â”‚  â”‚                    â–¼               â–¼                            â”‚ â”‚
â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚           â”‚ âœ… å¤ç”¨å·²æœ‰  â”‚  â”‚ âœ… è”çº§å¤åˆ¶ Score åˆ° Team   â”‚     â”‚ â”‚
â”‚  â”‚           â”‚ çš„ TeamScore â”‚  â”‚ â†’ åˆ›å»º TeamScore            â”‚     â”‚ â”‚
â”‚  â”‚           â”‚             â”‚  â”‚ â†’ è”çº§å¤åˆ¶æ‰€æœ‰åˆ†è°±           â”‚     â”‚ â”‚
â”‚  â”‚           â”‚ ä¸æ·»åŠ æ–°åˆ†è°± â”‚  â”‚ â†’ è”çº§å¤åˆ¶ annotations      â”‚     â”‚ â”‚
â”‚  â”‚           â”‚ (ä¸å¯¼å…¥Score â”‚  â”‚ â†’ å…±ç”¨ PDF                  â”‚     â”‚ â”‚
â”‚  â”‚           â”‚  è§„åˆ™ä¸€è‡´)   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚   è®°å½•: scoreMapping[åŸScoreId] = TeamScoreId                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  æ­¥éª¤ 3: åˆ›å»º TeamSetlist                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ åˆ›å»º TeamSetlist                                                â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€ sourceSetlistId = åŸ Setlist.serverId                      â”‚ â”‚
â”‚  â”‚ â””â”€â”€ å…¶ä»–å…ƒæ•°æ®å¤åˆ¶                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  æ­¥éª¤ 4: åˆ›å»º TeamSetlistScore å…³è”                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ FOR EACH åŸ SetlistScore:                                       â”‚ â”‚
â”‚  â”‚   åˆ›å»º TeamSetlistScore                                         â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ teamSetlistId = æ–°åˆ›å»ºçš„ TeamSetlist.id                   â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ teamScoreId = scoreMapping[åŸScoreId]                     â”‚ â”‚
â”‚  â”‚   â””â”€â”€ orderIndex = åŸé¡ºåº                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 ç›´æ¥åˆ›å»ºçš„å”¯ä¸€æ€§æ£€æŸ¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœ¨ Team ä¸­ç›´æ¥åˆ›å»º Score                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚ ç”¨æˆ·ç‚¹å‡» Add æŒ‰é’®    â”‚                          â”‚
â”‚                    â”‚ â†’ é€‰æ‹© "ç›´æ¥åˆ›å»º"   â”‚                          â”‚
â”‚                    â”‚ â†’ å¯¼å…¥ PDF          â”‚                          â”‚
â”‚                    â”‚ â†’ è¾“å…¥ title/composerâ”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚            â”‚ æ£€æŸ¥: Team ä¸­æ˜¯å¦æœ‰åŒå Scoreï¼Ÿ  â”‚                      â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                    YES              NO                               â”‚
â”‚                     â”‚               â”‚                                â”‚
â”‚                     â–¼               â–¼                                â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚          â”‚ æç¤º: "å›¢é˜Ÿä¸­å·²æœ‰ â”‚ â”‚ æ£€æŸ¥åˆ†è°±å”¯ä¸€æ€§    â”‚                  â”‚
â”‚          â”‚ åŒåæ›²ç›®"        â”‚ â”‚ (instrumentType)  â”‚                  â”‚
â”‚          â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚          â”‚ é€‰é¡¹:            â”‚           â”‚                            â”‚
â”‚          â”‚ â€¢ æ·»åŠ åˆ†è°±åˆ°å·²æœ‰  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚          â”‚ â€¢ å–æ¶ˆåˆ›å»º       â”‚   YES            NO                    â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚                    â”‚
â”‚                                  â–¼              â–¼                    â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                        â”‚ åˆ†è°±å·²å­˜åœ¨   â”‚  â”‚ åˆ›å»ºæˆåŠŸ    â”‚             â”‚
â”‚                        â”‚ æç¤ºå¹¶ç»ˆæ­¢   â”‚  â”‚             â”‚             â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.6 å¯¼å…¥è§„åˆ™æ€»ç»“

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| **ä» Add æŒ‰é’®å¯¼å…¥ Score** | |
| â†’ Team ä¸­æ— åŒå | âœ… å¯¼å…¥ï¼Œè”çº§åˆ›å»º TeamScore + æ‰€æœ‰ TeamInstrumentScore + annotations |
| â†’ Team ä¸­æœ‰åŒå | âŒ æ‹’ç»ï¼Œæç¤ºå» TeamScore è¯¦æƒ…é¡µæ·»åŠ åˆ†è°± |
| **ä» Add æŒ‰é’®å¯¼å…¥ Setlist** | |
| â†’ Team ä¸­æ— åŒå Setlist | âœ… å¯¼å…¥ï¼Œè”çº§å¤„ç†æ‰€æœ‰ Scoreï¼ˆå·²æœ‰çš„å¤ç”¨ï¼Œæ²¡æœ‰çš„åˆ›å»ºï¼‰|
| â†’ Team ä¸­æœ‰åŒå Setlist | âŒ æ‹’ç»å¯¼å…¥ |
| **åœ¨ TeamScore è¯¦æƒ…é¡µæ·»åŠ åˆ†è°±** | |
| â†’ ä» Library åŒåæ›²ç›®å¯¼å…¥ | âœ… åªèƒ½æ·»åŠ  Team ä¸­ä¸å­˜åœ¨çš„åˆ†è°±ç±»å‹ |
| â†’ ç›´æ¥åˆ›å»ºæ–°åˆ†è°± | âœ… åªè¦åˆ†è°±ç±»å‹ä¸é‡å¤ |
| **ç›´æ¥åˆ›å»º Score** | |
| â†’ Team ä¸­æ— åŒå | âœ… åˆ›å»ºæˆåŠŸ |
| â†’ Team ä¸­æœ‰åŒå | æç¤ºé€‰æ‹©ï¼šæ·»åŠ åˆ†è°±åˆ°å·²æœ‰ / å–æ¶ˆ |
| **PDF å¤„ç†** | ä¸æœ¬åœ° Library å…±ç”¨ï¼ŒåŸºäº pdfHash |

---

## 4. åŒæ­¥æµç¨‹

### 4.1 åŒæ­¥çŠ¶æ€æœº

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                             â”‚
                         â–¼                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”   æ•°æ®å˜æ›´(5sé˜²æŠ–)   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  success â”‚
    â”‚ idle  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ syncing â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²                              â”‚
        â”‚ network restored             â”‚ error / 412 conflict
        â”‚                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ paused â”‚ â—„â”€â”€ no network â”€â”€â”€ â”‚  error  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                              â”‚
        â”‚                              â”‚ retry(30s)
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å®Œæ•´åŒæ­¥å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Team åŒæ­¥å‘¨æœŸ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  FOR EACH Team (ç”¨æˆ·åŠ å…¥çš„å›¢é˜Ÿ):                                     â”‚
â”‚                                                                      â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘  é˜¶æ®µ 1: PUSH æœ¬åœ°å˜æ›´                                          â•‘ â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•‘  1. æ”¶é›†å¾…åŒæ­¥æ•°æ®:                                              â•‘ â”‚
â”‚  â•‘     WHERE teamId = ? AND syncStatus = 'pending'                â•‘ â”‚
â”‚  â•‘     â”œâ”€â”€ TeamScores                                             â•‘ â”‚
â”‚  â•‘     â”œâ”€â”€ TeamInstrumentScores (å« annotationsJson)              â•‘ â”‚
â”‚  â•‘     â”œâ”€â”€ TeamSetlists                                           â•‘ â”‚
â”‚  â•‘     â””â”€â”€ TeamSetlistScores                                      â•‘ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•‘  2. å‘é€è¯·æ±‚: POST /team/{teamId}/push                         â•‘ â”‚
â”‚  â•‘     è¯·æ±‚ä½“åŒ…å« clientTeamLibraryVersion å’Œå„å®ä½“æ•°ç»„            â•‘ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•‘  3. å¤„ç†å“åº”:                                                   â•‘ â”‚
â”‚  â•‘     â”œâ”€â”€ 200 OK â†’ æ›´æ–° syncStatus = 'synced'                    â•‘ â”‚
â”‚  â•‘     â””â”€â”€ 412 Conflict â†’ è·³åˆ°é˜¶æ®µ 2                              â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                â”‚                                     â”‚
â”‚                                â–¼                                     â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘  é˜¶æ®µ 2: PULL è¿œç¨‹å˜æ›´                                          â•‘ â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•‘  1. è¯·æ±‚å¢é‡æ•°æ®:                                               â•‘ â”‚
â”‚  â•‘     GET /team/{teamId}/pull?since={teamLibraryVersion}         â•‘ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•‘  2. å“åº”åŒ…å«:                                                   â•‘ â”‚
â”‚  â•‘     â”œâ”€â”€ teamLibraryVersion (æœ€æ–°ç‰ˆæœ¬å·)                        â•‘ â”‚
â”‚  â•‘     â”œâ”€â”€ teamScores, teamInstrumentScores (å« pdfHash)          â•‘ â”‚
â”‚  â•‘     â”œâ”€â”€ teamSetlists, teamSetlistScores                        â•‘ â”‚
â”‚  â•‘     â””â”€â”€ deleted æ•°ç»„                                           â•‘ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•‘  3. åˆå¹¶ç­–ç•¥:                                                   â•‘ â”‚
â”‚  â•‘     â”œâ”€â”€ æœ¬åœ° pending â†’ ä¿ç•™æœ¬åœ°                                 â•‘ â”‚
â”‚  â•‘     â”œâ”€â”€ æœ¬åœ° synced  â†’ ä½¿ç”¨æœåŠ¡å™¨æ•°æ®                           â•‘ â”‚
â”‚  â•‘     â””â”€â”€ æœ¬åœ°ä¸å­˜åœ¨   â†’ åˆ›å»ºæ–°è®°å½• (pdfSyncStatus=needsDownload) â•‘ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•‘  4. æ›´æ–°æœ¬åœ° teamLibraryVersion                                â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                â”‚                                     â”‚
â”‚                                â–¼                                     â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘  é˜¶æ®µ 3: PDF æ–‡ä»¶åŒæ­¥ (ç‹¬ç«‹é˜Ÿåˆ—ï¼ŒæŒ‰éœ€æ‰§è¡Œ)                        â•‘ â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•‘  æ³¨æ„: Team PDF ä¸è‡ªåŠ¨ä¸‹è½½ï¼                                    â•‘ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•‘  ä¸Šä¼ é˜Ÿåˆ— (æœ¬åœ°åˆ›å»ºçš„ PDF):                                      â•‘ â”‚
â”‚  â•‘  â”œâ”€â”€ pdfSyncStatus = 'pending' AND pdfHash IS NOT NULL         â•‘ â”‚
â”‚  â•‘  â””â”€â”€ ä½¿ç”¨å…¨å±€ pdfHash ç§’ä¼ æœºåˆ¶                                  â•‘ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•‘  ä¸‹è½½é˜Ÿåˆ— (ä»…ç”¨æˆ·æ‰“å¼€æ—¶è§¦å‘):                                    â•‘ â”‚
â”‚  â•‘  â”œâ”€â”€ pdfSyncStatus = 'needsDownload'                           â•‘ â”‚
â”‚  â•‘  â””â”€â”€ ç”¨æˆ·æ‰“å¼€ TeamInstrumentScore æ—¶æ‰ä¸‹è½½                      â•‘ â”‚
â”‚  â•‘                                                                 â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 å¤š Team åŒæ­¥ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤š Team åŒæ­¥                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ç”¨æˆ·å¯èƒ½åŠ å…¥å¤šä¸ª Teamï¼Œæ¯ä¸ª Team ç‹¬ç«‹åŒæ­¥:                           â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ User                                                         â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ Team A (teamLibraryVersion = 105)                       â”‚    â”‚
â”‚  â”‚ â”‚   â”œâ”€â”€ TeamScore A1                                        â”‚    â”‚
â”‚  â”‚ â”‚   â””â”€â”€ TeamSetlist A1                                      â”‚    â”‚
â”‚  â”‚ â”‚                                                            â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ Team B (teamLibraryVersion = 42)                        â”‚    â”‚
â”‚  â”‚ â”‚   â”œâ”€â”€ TeamScore B1, B2                                    â”‚    â”‚
â”‚  â”‚ â”‚   â””â”€â”€ TeamSetlist B1                                      â”‚    â”‚
â”‚  â”‚ â”‚                                                            â”‚    â”‚
â”‚  â”‚ â””â”€â”€ Team C (teamLibraryVersion = 7)                         â”‚    â”‚
â”‚  â”‚     â””â”€â”€ TeamScore C1                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  åŒæ­¥é¡ºåº: å¹¶è¡Œæˆ–ä¸²è¡Œéƒ½å¯ä»¥ï¼Œæ¯ä¸ª Team ç‹¬ç«‹ç‰ˆæœ¬å·                     â”‚
â”‚  è§¦å‘æ—¶æœº: ä»»ä¸€ Team æ•°æ®å˜æ›´éƒ½ä¼šè§¦å‘è¯¥ Team çš„åŒæ­¥                   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 Push è¯·æ±‚æ ¼å¼

**è¯·æ±‚ç«¯ç‚¹ï¼š** `POST /team/{teamId}/push`

**è¯·æ±‚ä½“ï¼š**

```dart
TeamSyncPushRequest {
  clientTeamLibraryVersion: int,       // å®¢æˆ·ç«¯å½“å‰ç‰ˆæœ¬å·
  teamScores: List<TeamScoreData>,     // TeamScore å®ä½“
  teamInstrumentScores: List<TeamInstrumentScoreData>,  // å« pdfHash + annotationsJson
  teamSetlists: List<TeamSetlistData>,
  teamSetlistScores: List<TeamSetlistScoreData>,
  deletes: List<String>,               // ["teamScore:123", "teamInstrumentScore:456", ...]
}
```

### 4.5 Pull å“åº”æ ¼å¼

**è¯·æ±‚ç«¯ç‚¹ï¼š** `GET /team/{teamId}/pull?since={version}`

**å“åº”ä½“ï¼š**

```dart
TeamSyncPullResponse {
  teamLibraryVersion: int,              // æœ€æ–°ç‰ˆæœ¬å·
  isFullSync: bool,                     // æ˜¯å¦å…¨é‡åŒæ­¥

  teamScores: List<TeamScoreData>?,
  teamInstrumentScores: List<TeamInstrumentScoreData>?,  // å« pdfHash + annotationsJson
  teamSetlists: List<TeamSetlistData>?,
  teamSetlistScores: List<TeamSetlistScoreData>?,

  deleted: List<String>?,               // å·²åˆ é™¤å®ä½“
}

TeamInstrumentScoreData {
  id: int,
  teamScoreId: int,
  instrumentType: String,
  customInstrument: String?,
  pdfHash: String?,                     // PDF æ ‡è¯†ï¼Œç”¨äºä¸‹è½½
  annotationsJson: String?,             // æ ‡æ³¨æ•°æ®
  version: int,
  isDeleted: bool,
}
```

---

## 5. PDF æ–‡ä»¶å¤„ç†

### 5.1 PDF å­˜å‚¨æ¶æ„ï¼ˆå¤ç”¨ä¸ªäººåº“ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PDF å­˜å‚¨æ¶æ„ (Team ä¸ä¸ªäººåº“å…±äº«)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  å®¢æˆ·ç«¯æœ¬åœ°å­˜å‚¨:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  /documents/pdfs/                    â† ç»Ÿä¸€ç›®å½•              â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ abc123def456.pdf                                        â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ 789xyz000111.pdf                                        â”‚    â”‚
â”‚  â”‚  â””â”€â”€ ...                                                     â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  ä¸ªäººåº“ InstrumentScore:                                     â”‚    â”‚
â”‚  â”‚  â”‚ id=1 â”‚ pdfHash=abc123 â”‚ pdfPath=/pdfs/abc123.pdf â”‚       â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  Team InstrumentScore:                                       â”‚    â”‚
â”‚  â”‚  â”‚ id=1 â”‚ pdfHash=abc123 â”‚ pdfPath=/pdfs/abc123.pdf â”‚ â† å…±äº« â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  å¼•ç”¨è®¡æ•° = ä¸ªäººåº“å¼•ç”¨ + Team å¼•ç”¨                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  æœåŠ¡å™¨å…¨å±€å­˜å‚¨:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  /uploads/global/pdfs/              â† å…¨å±€ç›®å½•ï¼Œè·¨ç”¨æˆ·å»é‡    â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ abc123def456.pdf                                        â”‚    â”‚
â”‚  â”‚  â””â”€â”€ ...                                                     â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  å…¨å±€å¼•ç”¨è®¡æ•° = æ‰€æœ‰ä¸ªäººåº“ + æ‰€æœ‰ Team çš„å¼•ç”¨                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 PDF æŒ‰éœ€ä¸‹è½½æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Team PDF æŒ‰éœ€ä¸‹è½½                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç”¨æˆ·æ‰“å¼€ Team ä¸­çš„æŸä¸ª Score                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è·å–è¯¥ Score ä¸‹ç”¨æˆ·é€‰æ‹©çš„ TeamInstrumentScore                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ£€æŸ¥æœ¬åœ°æ˜¯å¦å·²æœ‰ pdfHash å¯¹åº”çš„æ–‡ä»¶                             â”‚ â”‚
â”‚  â”‚ (å¯èƒ½æ¥è‡ªä¸ªäººåº“æˆ–å…¶ä»– Team)                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                   å·²å­˜åœ¨            ä¸å­˜åœ¨                           â”‚
â”‚                      â”‚               â”‚                               â”‚
â”‚                      â–¼               â–¼                               â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚          â”‚ å¤ç”¨å·²æœ‰æ–‡ä»¶     â”‚  â”‚ æ˜¾ç¤ºä¸‹è½½è¿›åº¦                     â”‚   â”‚
â”‚          â”‚ æ›´æ–° pdfPath    â”‚  â”‚ GET /file/download/{pdfHash}    â”‚   â”‚
â”‚          â”‚ pdfSyncStatus   â”‚  â”‚                                  â”‚   â”‚
â”‚          â”‚  = 'synced'     â”‚  â”‚ ä¸‹è½½å®Œæˆ:                        â”‚   â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ ä¿å­˜åˆ° /pdfs/{hash}.pdf        â”‚   â”‚
â”‚                               â”‚ â€¢ éªŒè¯ Hash                      â”‚   â”‚
â”‚                               â”‚ â€¢ æ›´æ–° pdfPath, pdfSyncStatus    â”‚   â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚                              â”‚
â”‚                                       â–¼                              â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                         â”‚ æ‰“å¼€ PDF é˜…è¯»å™¨æ˜¾ç¤ºå†…å®¹  â”‚                 â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 PDF ä¸Šä¼ æµç¨‹ï¼ˆç§’ä¼ æœºåˆ¶ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Team PDF ä¸Šä¼                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  åœºæ™¯ 1: ç›´æ¥åœ¨ Team åˆ›å»º Score (å¯¼å…¥æ–° PDF)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. è®¡ç®— PDF çš„ MD5 Hash                                        â”‚ â”‚
â”‚  â”‚ 2. è°ƒç”¨ GET /file/checkHash?hash={hash}                        â”‚ â”‚
â”‚  â”‚    â”œâ”€â”€ å·²å­˜åœ¨ â†’ ç§’ä¼ æˆåŠŸï¼Œæ— éœ€ä¸Šä¼                               â”‚ â”‚
â”‚  â”‚    â””â”€â”€ ä¸å­˜åœ¨ â†’ POST /file/upload ä¸Šä¼ æ–‡ä»¶                     â”‚ â”‚
â”‚  â”‚ 3. æ›´æ–° pdfSyncStatus = 'synced'                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  åœºæ™¯ 2: ä»ä¸ªäººåº“å¤åˆ¶ Score åˆ° Team                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. å¤åˆ¶ pdfHash å€¼                                             â”‚ â”‚
â”‚  â”‚ 2. å¦‚æœä¸ªäººåº“çš„ PDF å·²åŒæ­¥ (pdfSyncStatus='synced')             â”‚ â”‚
â”‚  â”‚    â†’ Team çš„ pdfSyncStatus = 'synced' (æœåŠ¡å™¨å·²æœ‰)              â”‚ â”‚
â”‚  â”‚ 3. å¦‚æœä¸ªäººåº“çš„ PDF æœªåŒæ­¥ (pdfSyncStatus='pending')            â”‚ â”‚
â”‚  â”‚    â†’ Team çš„ pdfSyncStatus = 'pending' (ç­‰å¾…ä¸Šä¼ )               â”‚ â”‚
â”‚  â”‚ 4. æœ¬åœ°æ–‡ä»¶å¤ç”¨ï¼Œæ— éœ€å¤åˆ¶æ–‡ä»¶                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 å¼•ç”¨è®¡æ•°ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ¬åœ° PDF å¼•ç”¨è®¡æ•°                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  è®¡ç®—å…¬å¼:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ localRefCount =                                                 â”‚ â”‚
â”‚  â”‚   COUNT(InstrumentScore WHERE pdfHash = ? AND deletedAt IS NULL)â”‚ â”‚
â”‚  â”‚ + COUNT(TeamInstrumentScore WHERE pdfHash = ? AND deletedAt IS NULL) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  åˆ é™¤ TeamInstrumentScore æ—¶:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. è·å– pdfHash                                                 â”‚ â”‚
â”‚  â”‚ 2. è®¡ç®—åˆ é™¤åçš„ localRefCount                                   â”‚ â”‚
â”‚  â”‚ 3. if localRefCount == 0 â†’ åˆ é™¤æœ¬åœ° PDF æ–‡ä»¶                    â”‚ â”‚
â”‚  â”‚ 4. æœåŠ¡å™¨ç«¯å•ç‹¬å¤„ç†å…¨å±€å¼•ç”¨è®¡æ•°                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. å†²çªè§£å†³

### 6.1 ç‰ˆæœ¬å†²çª (412 Conflict)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰ˆæœ¬å†²çªåœºæ™¯                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  T1: æœåŠ¡å™¨ teamLibraryVersion = 10                                 â”‚
â”‚      â”œâ”€â”€ æˆå‘˜ A è®¾å¤‡ = 10                                           â”‚
â”‚      â””â”€â”€ æˆå‘˜ B è®¾å¤‡ = 10                                           â”‚
â”‚                                                                      â”‚
â”‚  T2: æˆå‘˜ A Push "æ–°æ›²ç›®" æˆåŠŸ                                       â”‚
â”‚      æœåŠ¡å™¨ teamLibraryVersion = 11                                 â”‚
â”‚      æˆå‘˜ A è®¾å¤‡ = 11                                                â”‚
â”‚                                                                      â”‚
â”‚  T3: æˆå‘˜ B ä¿®æ”¹æ›²ç›®ï¼ˆæœ¬åœ°ç‰ˆæœ¬ä» = 10ï¼‰                               â”‚
â”‚                                                                      â”‚
â”‚  T4: æˆå‘˜ B Pushï¼Œå¸¦ç€ clientTeamLibraryVersion = 10                â”‚
â”‚      æœåŠ¡å™¨: 10 < 11 â†’ è¿”å› 412                                     â”‚
â”‚                                                                      â”‚
â”‚  T5: æˆå‘˜ B Pullï¼Œè·å–ç‰ˆæœ¬ 11 çš„æ•°æ®                                 â”‚
â”‚      æˆå‘˜ B æœ¬åœ°ç‰ˆæœ¬ = 11                                            â”‚
â”‚      pending æ•°æ®è¢«ä¿ç•™ï¼ˆæœ¬åœ°èƒœå‡ºï¼‰                                  â”‚
â”‚                                                                      â”‚
â”‚  T6: æˆå‘˜ B å†æ¬¡ Pushï¼ŒæˆåŠŸ                                          â”‚
â”‚      æœåŠ¡å™¨ç‰ˆæœ¬ = 12                                                 â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ•°æ®å†²çª Merge é€»è¾‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Merge å†³ç­–æ ‘                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  å¯¹äºæ¯ä¸ªæœåŠ¡å™¨è¿”å›çš„å®ä½“:                                           â”‚
â”‚                                                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚ æœåŠ¡å™¨å®ä½“åˆ°è¾¾   â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                             â”‚                                        â”‚
â”‚                             â–¼                                        â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚ æœ¬åœ°å­˜åœ¨è®°å½•ï¼Ÿ   â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                     â”‚              â”‚                                 â”‚
â”‚                    YES             NO                                â”‚
â”‚                     â”‚              â”‚                                 â”‚
â”‚                     â–¼              â–¼                                 â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚            â”‚ æ£€æŸ¥ syncStatus â”‚  â”‚ åˆ›å»ºæ–°è®°å½•        â”‚                   â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚ syncStatus=syncedâ”‚                   â”‚
â”‚                    â”‚         â”‚ pdfSyncStatus=   â”‚                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  needsDownload   â”‚                   â”‚
â”‚         â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚      pending              synced                                     â”‚
â”‚         â”‚                    â”‚                                       â”‚
â”‚         â–¼                    â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ æœ¬åœ°ä¼˜å…ˆ         â”‚  â”‚ æœåŠ¡å™¨ä¼˜å…ˆ       â”‚                           â”‚
â”‚  â”‚ è·³è¿‡ï¼Œä¸è¦†ç›–     â”‚  â”‚ ç”¨æœåŠ¡å™¨æ•°æ®æ›´æ–°  â”‚                           â”‚
â”‚  â”‚ hadConflict=trueâ”‚  â”‚ syncStatus=syncedâ”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 åˆ é™¤å†²çªå¤„ç†

| åœºæ™¯ | æ¡ä»¶ | å¤„ç†æ–¹å¼ |
|------|------|---------|
| æœåŠ¡å™¨åˆ é™¤ + æœ¬åœ°å·²åŒæ­¥ | æœ¬åœ° syncStatus='synced' | ç‰©ç†åˆ é™¤æœ¬åœ°è®°å½• |
| æœåŠ¡å™¨åˆ é™¤ + æœ¬åœ°æœ‰ä¿®æ”¹ | æœ¬åœ° syncStatus='pending' | ä¿ç•™æœ¬åœ°ï¼Œä¸‹æ¬¡ Push æ—¶æ¢å¤ |
| æœ¬åœ°åˆ é™¤ + æœåŠ¡å™¨æœ‰æ›´æ–° | æœ¬åœ° deletedAt ä¸ä¸ºç©ºä¸” pending | åˆ é™¤ä¼˜å…ˆï¼ŒPush åˆ é™¤è¯·æ±‚ |

---

## 7. ç‰¹æ®Šåœºæ™¯

### 7.1 åŠ å…¥æ–° Teamï¼ˆå…¨é‡åŒæ­¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŠ å…¥æ–° Team æµç¨‹                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. ç”¨æˆ·é€šè¿‡é‚€è¯·ç åŠ å…¥ Team                                          â”‚
â”‚     â”‚                                                                â”‚
â”‚     â–¼                                                                â”‚
â”‚  2. åˆå§‹åŒ–è¯¥ Team çš„æœ¬åœ°çŠ¶æ€                                         â”‚
â”‚     teamLibraryVersion = 0                                          â”‚
â”‚     â”‚                                                                â”‚
â”‚     â–¼                                                                â”‚
â”‚  3. Pull å…¨é‡å…ƒæ•°æ® (since = 0)                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚ æœåŠ¡å™¨è¿”å›æ‰€æœ‰: TeamScores, TeamInstrumentScores,â”‚             â”‚
â”‚     â”‚ TeamSetlists, TeamSetlistScores                 â”‚             â”‚
â”‚     â”‚ TeamInstrumentScore åŒ…å« pdfHash (ç”¨äºåç»­ä¸‹è½½) â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚     â”‚                                                                â”‚
â”‚     â–¼                                                                â”‚
â”‚  4. ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“                                                 â”‚
â”‚     æ‰€æœ‰ TeamInstrumentScore çš„ pdfSyncStatus = 'needsDownload'     â”‚
â”‚     â”‚                                                                â”‚
â”‚     â–¼                                                                â”‚
â”‚  5. UI ç«‹å³å¯ç”¨                                                      â”‚
â”‚     ç”¨æˆ·å¯ä»¥çœ‹åˆ° Team çš„æ›²åº“åˆ—è¡¨ã€æ›²å•åˆ—è¡¨                            â”‚
â”‚     â”‚                                                                â”‚
â”‚     â–¼                                                                â”‚
â”‚  6. PDF æŒ‰éœ€ä¸‹è½½                                                     â”‚
â”‚     ç”¨æˆ·æ‰“å¼€æŸä¸ªåˆ†è°±æ—¶æ‰ä¸‹è½½å¯¹åº” PDF                                  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 é€€å‡º Team

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€€å‡º Team æµç¨‹                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. ç”¨æˆ·ç‚¹å‡» "é€€å‡ºå›¢é˜Ÿ"                                              â”‚
â”‚     â”‚                                                                â”‚
â”‚     â–¼                                                                â”‚
â”‚  2. æ£€æŸ¥æ˜¯å¦æœ‰æœªåŒæ­¥æ•°æ®                                             â”‚
â”‚     â”œâ”€ æœ‰ â†’ æç¤º "æœ‰æœªåŒæ­¥çš„æ•°æ®ï¼Œç¡®å®šé€€å‡ºï¼Ÿ"                        â”‚
â”‚     â””â”€ æ—  â†’ ç»§ç»­                                                     â”‚
â”‚     â”‚                                                                â”‚
â”‚     â–¼                                                                â”‚
â”‚  3. è°ƒç”¨ API é€€å‡º Team                                               â”‚
â”‚     â”‚                                                                â”‚
â”‚     â–¼                                                                â”‚
â”‚  4. æ¸…ç©ºè¯¥ Team çš„æœ¬åœ°æ•°æ®                                           â”‚
â”‚     â”œâ”€ åˆ é™¤è¯¥ Team çš„æ‰€æœ‰ TeamScore, TeamInstrumentScore ç­‰         â”‚
â”‚     â”œâ”€ æ£€æŸ¥ PDF å¼•ç”¨è®¡æ•°ï¼Œåˆ é™¤ä¸å†éœ€è¦çš„ PDF                         â”‚
â”‚     â””â”€ åˆ é™¤è¯¥ Team çš„ TeamSyncState                                 â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 ç¦»çº¿ä½¿ç”¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¦»çº¿åœºæ™¯                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ç¦»çº¿æ“ä½œ:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ æ‰€æœ‰æ“ä½œæ­£å¸¸å†™å…¥æœ¬åœ°æ•°æ®åº“                                  â”‚    â”‚
â”‚  â”‚ â€¢ syncStatus = 'pending'                                    â”‚    â”‚
â”‚  â”‚ â€¢ UI æ­£å¸¸å“åº”                                                â”‚    â”‚
â”‚  â”‚ â€¢ ç½‘ç»œæ¢å¤åè‡ªåŠ¨åŒæ­¥                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  ç¦»çº¿æ—¶å°è¯•æ‰“å¼€æœªä¸‹è½½çš„ PDF:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ æ˜¾ç¤º "PDF å°šæœªä¸‹è½½ï¼Œè¯·è¿æ¥ç½‘ç»œåå†è¯•"                       â”‚    â”‚
â”‚  â”‚ â€¢ æˆ–æ˜¾ç¤ºå ä½å›¾                                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 æˆå‘˜ç¼–è¾‘åŒä¸€æ•°æ®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤šæˆå‘˜ç¼–è¾‘å†²çª                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  åœºæ™¯: æˆå‘˜ A å’Œ B åŒæ—¶ç¼–è¾‘åŒä¸€ä¸ª TeamScore                          â”‚
â”‚                                                                      â”‚
â”‚  T1: æˆå‘˜ A å’Œ B éƒ½çœ‹åˆ° BPM = 120                                    â”‚
â”‚                                                                      â”‚
â”‚  T2: æˆå‘˜ A æ”¹ä¸º BPM = 130ï¼Œæœ¬åœ° pending                             â”‚
â”‚      æˆå‘˜ B æ”¹ä¸º BPM = 140ï¼Œæœ¬åœ° pending                             â”‚
â”‚                                                                      â”‚
â”‚  T3: æˆå‘˜ A å…ˆ Push æˆåŠŸï¼ŒæœåŠ¡å™¨ BPM = 130                           â”‚
â”‚                                                                      â”‚
â”‚  T4: æˆå‘˜ B Push å¤±è´¥ (412)                                          â”‚
â”‚      æˆå‘˜ B Pullï¼Œå‘ç°æœåŠ¡å™¨ BPM = 130                               â”‚
â”‚      ä½†æˆå‘˜ B æœ¬åœ°æ˜¯ pendingï¼Œæ‰€ä»¥ä¿ç•™ BPM = 140                     â”‚
â”‚                                                                      â”‚
â”‚  T5: æˆå‘˜ B å†æ¬¡ Pushï¼ŒæˆåŠŸï¼ŒæœåŠ¡å™¨ BPM = 140                        â”‚
â”‚                                                                      â”‚
â”‚  ç»“æœ: Last-Write-Winsï¼Œæˆå‘˜ B çš„ä¿®æ”¹æœ€ç»ˆç”Ÿæ•ˆ                        â”‚
â”‚  æ³¨æ„: è¿™æ˜¯é¢„æœŸè¡Œä¸ºï¼Œæ‰€æœ‰æˆå‘˜éƒ½æœ‰ç¼–è¾‘æƒé™                            â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é™„å½•

### A. API ç«¯ç‚¹æ±‡æ€»

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/team/{teamId}/push` | POST | æ¨é€æœ¬åœ°å˜æ›´ |
| `/team/{teamId}/pull?since={version}` | GET | æ‹‰å–è¿œç¨‹å˜æ›´ |
| `/team/{teamId}/scores` | GET | è·å– Team æ‰€æœ‰ Score |
| `/team/{teamId}/setlists` | GET | è·å– Team æ‰€æœ‰ Setlist |
| `/file/checkHash?hash={hash}` | GET | æ£€æŸ¥ PDF æ˜¯å¦å·²å­˜åœ¨ï¼ˆç§’ä¼ ï¼‰ |
| `/file/upload` | POST | ä¸Šä¼  PDF |
| `/file/download/{hash}` | GET | ä¸‹è½½ PDF |

### B. æœ¬åœ°æ•°æ®åº“è¡¨ç»“æ„

```sql
-- Team åŒæ­¥çŠ¶æ€
CREATE TABLE team_sync_state (
  team_id INTEGER PRIMARY KEY,
  team_library_version INTEGER NOT NULL DEFAULT 0,
  last_sync_at TEXT
);

-- TeamScore
CREATE TABLE team_scores (
  id TEXT PRIMARY KEY,
  server_id INTEGER,
  team_id INTEGER NOT NULL,
  title TEXT NOT NULL,
  composer TEXT NOT NULL,
  bpm INTEGER DEFAULT 120,
  created_by_id INTEGER NOT NULL,
  source_score_id INTEGER,
  sync_status TEXT NOT NULL DEFAULT 'pending',
  version INTEGER NOT NULL DEFAULT 0,
  created_at TEXT NOT NULL,
  updated_at TEXT,
  deleted_at TEXT,
  UNIQUE(team_id, title, composer)
);

-- TeamInstrumentScore
CREATE TABLE team_instrument_scores (
  id TEXT PRIMARY KEY,
  server_id INTEGER,
  team_score_id TEXT NOT NULL,
  instrument_type TEXT NOT NULL,
  custom_instrument TEXT,
  pdf_hash TEXT,
  pdf_path TEXT,
  pdf_sync_status TEXT NOT NULL DEFAULT 'pending',
  annotations_json TEXT,
  source_instrument_score_id INTEGER,
  sync_status TEXT NOT NULL DEFAULT 'pending',
  version INTEGER NOT NULL DEFAULT 0,
  created_at TEXT NOT NULL,
  updated_at TEXT,
  deleted_at TEXT,
  FOREIGN KEY (team_score_id) REFERENCES team_scores(id),
  UNIQUE(team_score_id, instrument_type, custom_instrument)
);

-- TeamSetlist
CREATE TABLE team_setlists (
  id TEXT PRIMARY KEY,
  server_id INTEGER,
  team_id INTEGER NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  created_by_id INTEGER NOT NULL,
  source_setlist_id INTEGER,
  sync_status TEXT NOT NULL DEFAULT 'pending',
  version INTEGER NOT NULL DEFAULT 0,
  created_at TEXT NOT NULL,
  updated_at TEXT,
  deleted_at TEXT,
  UNIQUE(team_id, name)
);

-- TeamSetlistScore
CREATE TABLE team_setlist_scores (
  id TEXT PRIMARY KEY,
  server_id INTEGER,
  team_setlist_id TEXT NOT NULL,
  team_score_id TEXT NOT NULL,
  order_index INTEGER NOT NULL DEFAULT 0,
  sync_status TEXT NOT NULL DEFAULT 'pending',
  version INTEGER NOT NULL DEFAULT 0,
  created_at TEXT NOT NULL,
  updated_at TEXT,
  deleted_at TEXT,
  FOREIGN KEY (team_setlist_id) REFERENCES team_setlists(id),
  FOREIGN KEY (team_score_id) REFERENCES team_scores(id),
  UNIQUE(team_setlist_id, team_score_id)
);
```

### C. é”™è¯¯å¤„ç†

| é”™è¯¯ç±»å‹ | å¤„ç†æ–¹å¼ |
|---------|---------|
| ç½‘ç»œè¶…æ—¶ | é‡è¯• 3 æ¬¡ï¼ŒæŒ‡æ•°é€€é¿ |
| 401 Unauthorized | è·³è½¬ç™»å½•é¡µé¢ |
| 403 Not Team Member | æç¤º "ä½ ä¸æ˜¯è¯¥å›¢é˜Ÿæˆå‘˜"ï¼Œç§»é™¤æœ¬åœ° Team æ•°æ® |
| 412 Conflict | Pull â†’ Merge â†’ é‡è¯• Push |
| 404 Team Not Found | å›¢é˜Ÿå¯èƒ½å·²è§£æ•£ï¼Œæ¸…ç†æœ¬åœ°æ•°æ® |
| PDF ä¸‹è½½å¤±è´¥ | ä¿æŒ needsDownload çŠ¶æ€ï¼Œç”¨æˆ·å†æ¬¡æ‰“å¼€æ—¶é‡è¯• |

### D. æ—¥å¿—è®°å½•

```
[TeamSyncService] === TEAM SYNC START (teamId=123) ===
[TeamSyncService] Push: teamScores=2, teamInstrumentScores=3, deletes=0
[TeamSyncService] Pull: pulled=5, conflicts=1
[TeamSyncService] PDF: pending uploads=1, needsDownload=3
[TeamSyncService] === TEAM SYNC COMPLETE (teamId=123): 1523ms ===
```
